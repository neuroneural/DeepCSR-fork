array is read
[2023-06-28 15:06:41,951][__main__][INFO] - Predicting surfaces with DeepCSR
Config:
user_config: null
inputs:
  mri_id: 200008
  mri_vol_path: /data/users2/washbee/speedrun/deepcsr-preprocessed/200008/mri.nii.gz
  model_checkpoint: /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir/best_model.pth
  model_surfaces:
  - lh_pial
  - lh_white
  - rh_pial
  - rh_white
generator:
  bbox_size:
  - 192.0
  - 228.0
  - 192.0
  resolution: 256
  points_batch_size: 1000000
  isrpr_vol_post_process: true
  isrpr_vol_smooth: 1.0
  fix_topology: true
  iso_surface_level: 0.0
model:
  hypercol: true
  device: cuda:0
outputs:
  output_dir: /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir-timing/checkpoints/bmtest-set/
  save_all: false

[2023-06-28 15:06:44,498][__main__][INFO] - MRI /data/users2/washbee/speedrun/deepcsr-preprocessed/200008/mri.nii.gz read with torch.Size([1, 182, 218, 182]) dimensions in 2.5469 secs

*********before loading model
 
Device 0: b'Tesla V100-SXM2-32GB', Memory : (95.38% free): 34359738368(total), 32771538944 (free), 1588199424 (used)
Max Memory occupied by tensors: 29360640
Max Memory Cached: 31457280
Current Memory occupied by tensors: 29360640
Current Memory cached occupied by tensors: 31457280


*********after loading model
 
Device 0: b'Tesla V100-SXM2-32GB', Memory : (95.27% free): 34359738368(total), 32735887360 (free), 1623851008 (used)
Max Memory occupied by tensors: 49632256
Max Memory Cached: 67108864
Current Memory occupied by tensors: 49632256
Current Memory cached occupied by tensors: 67108864

[2023-06-28 15:06:44,651][__main__][INFO] - 0.1516 secs for DeepCSR model setup:
DeepCSRNetwork(
  (encoder): HypercolumnNetwork(
    (max_pool): MaxPool3d(kernel_size=3, stride=2, padding=1, dilation=1, ceil_mode=False)
    (conv_in): Conv3d(1, 8, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
    (conv_0): Conv3d(8, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
    (conv_1): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
    (conv_2): Conv3d(32, 64, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
    (conv_3): Conv3d(64, 128, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
    (fc): Linear(in_features=4608, out_features=264, bias=True)
    (point_pool): PointPooling()
  )
  (decoder): OCCNetDecoder(
    (fc_p): Conv1d(3, 256, kernel_size=(1,), stride=(1,))
    (block0): CResnetBlockConv1d(
      (bn_0): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (bn_1): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (fc_0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (fc_1): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (actvn): ReLU()
    )
    (block1): CResnetBlockConv1d(
      (bn_0): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (bn_1): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (fc_0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (fc_1): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (actvn): ReLU()
    )
    (block2): CResnetBlockConv1d(
      (bn_0): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (bn_1): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (fc_0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (fc_1): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (actvn): ReLU()
    )
    (block3): CResnetBlockConv1d(
      (bn_0): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (bn_1): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (fc_0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (fc_1): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (actvn): ReLU()
    )
    (block4): CResnetBlockConv1d(
      (bn_0): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (bn_1): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (fc_0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (fc_1): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (actvn): ReLU()
    )
    (bn): CBatchNorm1d(
      (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
      (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
      (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
    )
    (fc_out): Conv1d(256, 4, kernel_size=(1,), stride=(1,))
  )
)
[2023-06-28 15:06:44,652][__main__][INFO] - Total number of parameters: 5060188
[2023-06-28 15:06:44,728][__main__][INFO] - Model weights at iteration 42000 and validation loss 2378.6959 loaded from /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir/best_model.pth in 0.0756 secs





model size: 19.325MB





[2023-06-28 15:06:44,729][__main__][INFO] - predicting implicit surfaces ...
[2023-06-28 15:06:44,876][__main__][INFO] - 16777216 query points generated to predict implicit surfaces
[2023-06-28 15:07:01,843][__main__][INFO] - predicted 9/17 batches of query points in 17.1136 secs
[2023-06-28 15:07:13,435][__main__][INFO] - Implicit surface prediction of shape (256, 256, 256, 4) computed in 28.6983 secs
[2023-06-28 15:07:13,436][__main__][INFO] - extracting meshes...
[2023-06-28 15:07:13,894][__main__][INFO] - Post-processing predicted implicit surface representation for surface lh_pial ...
[2023-06-28 15:07:14,115][__main__][INFO] - Post-processing predicted implicit surface representation for surface lh_white ...
[2023-06-28 15:07:14,329][__main__][INFO] - Post-processing predicted implicit surface representation for surface rh_pial ...
[2023-06-28 15:07:14,508][__main__][INFO] - Post-processing predicted implicit surface representation for surface rh_white ...
[2023-06-28 15:07:16,054][__main__][INFO] - Post-processed predicted implicit surface representation for surface lh_pial has (122, 221, 196) voxels and was computed in 2.1604 secs
[2023-06-28 15:07:16,056][__main__][INFO] - Smoothing predicted implicit surface representation for surface lh_pial with Gaussian kernel radius of 1.0...
[2023-06-28 15:07:16,163][__main__][INFO] - Smoothed predicted implicit surface for lh_pial in 0.1069 secs
[2023-06-28 15:07:16,270][__main__][INFO] - Post-processed predicted implicit surface representation for surface lh_white has (114, 217, 183) voxels and was computed in 2.1553 secs
[2023-06-28 15:07:16,271][__main__][INFO] - Smoothing predicted implicit surface representation for surface lh_white with Gaussian kernel radius of 1.0...
[2023-06-28 15:07:16,368][__main__][INFO] - Smoothed predicted implicit surface for lh_white in 0.0969 secs
[2023-06-28 15:07:16,646][__main__][INFO] - Post-processed predicted implicit surface representation for surface rh_pial has (121, 221, 197) voxels and was computed in 2.3173 secs
[2023-06-28 15:07:16,647][__main__][INFO] - Smoothing predicted implicit surface representation for surface rh_pial with Gaussian kernel radius of 1.0...
[2023-06-28 15:07:16,685][__main__][INFO] - Post-processed predicted implicit surface representation for surface rh_white has (116, 217, 188) voxels and was computed in 2.1764 secs
[2023-06-28 15:07:16,686][__main__][INFO] - Smoothing predicted implicit surface representation for surface rh_white with Gaussian kernel radius of 1.0...
[2023-06-28 15:07:16,765][__main__][INFO] - Smoothed predicted implicit surface for rh_pial in 0.1176 secs
[2023-06-28 15:07:16,791][__main__][INFO] - Smoothed predicted implicit surface for rh_white in 0.1049 secs
[2023-06-28 15:07:18,599][__main__][INFO] - fixing topology of surface with nighres toolbox...
[2023-06-28 15:07:18,599][__main__][INFO] - fixing topology of surface with nighres toolbox...
[2023-06-28 15:07:18,602][__main__][INFO] - fixing topology of surface with nighres toolbox...
[2023-06-28 15:07:18,603][__main__][INFO] - fixing topology of surface with nighres toolbox...

Topology Correction

Topology Correction

Topology Correction

Topology Correction
Opening LUT: java.io.FileInputStream@533ddba
Opening LUT: java.io.FileInputStream@533ddba
Opening LUT: java.io.FileInputStream@533ddba
Opening LUT: java.io.FileInputStream@533ddba
Simple points: 2537750
intialize from bounding box
Simple points: 2537750
Simple points: 2537750
Simple points: 2537750
intialize from bounding box
intialize from min levelset
intialize from min levelset
initialization
initialization
initialization
fast marching correction (levelsets)
fast marching correction (levelsets)
initialization
fast marching correction (levelsets)
fast marching correction (levelsets)
init
init
init
init
done
[2023-06-28 15:07:41,816][__main__][INFO] - Fixed topology of surface lh_white using nighres in 23.2168 secs
[2023-06-28 15:07:41,817][__main__][INFO] - extracting 0.0 iso-surface of surface lh_white...
[2023-06-28 15:07:42,234][__main__][INFO] - Surface lh_white extracted in 0.1699 secs and saved to /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir-timing/checkpoints/bmtest-set/200008_lh_white.stl
done
[2023-06-28 15:07:44,320][__main__][INFO] - Fixed topology of surface rh_white using nighres in 25.7180 secs
[2023-06-28 15:07:44,320][__main__][INFO] - extracting 0.0 iso-surface of surface rh_white...
[2023-06-28 15:07:44,755][__main__][INFO] - Surface rh_white extracted in 0.1779 secs and saved to /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir-timing/checkpoints/bmtest-set/200008_rh_white.stl
done
done
[2023-06-28 15:07:46,320][__main__][INFO] - Fixed topology of surface rh_pial using nighres in 27.7208 secs
[2023-06-28 15:07:46,321][__main__][INFO] - extracting 0.0 iso-surface of surface rh_pial...
[2023-06-28 15:07:46,351][__main__][INFO] - Fixed topology of surface lh_pial using nighres in 27.7479 secs
[2023-06-28 15:07:46,352][__main__][INFO] - extracting 0.0 iso-surface of surface lh_pial...
[2023-06-28 15:07:46,589][__main__][INFO] - Surface rh_pial extracted in 0.1526 secs and saved to /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir-timing/checkpoints/bmtest-set/200008_rh_pial.stl
[2023-06-28 15:07:46,660][__main__][INFO] - Surface lh_pial extracted in 0.1596 secs and saved to /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir-timing/checkpoints/bmtest-set/200008_lh_pial.stl
[2023-06-28 15:07:47,183][__main__][INFO] - Surfaces extracted in 33.7463 secs
0 - override config
Device 0: b'Tesla V100-SXM2-32GB', Memory : (99.18% free): 34359738368(total), 34079506432 (free), 280231936 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - read MRI
Device 0: b'Tesla V100-SXM2-32GB', Memory : (99.17% free): 34359738368(total), 34075967488 (free), 283770880 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - setup model
Device 0: b'Tesla V100-SXM2-32GB', Memory : (95.38% free): 34359738368(total), 32771538944 (free), 1588199424 (used)
Max Memory occupied by tensors: 29360640
Max Memory Cached: 31457280
Current Memory occupied by tensors: 29360640
Current Memory cached occupied by tensors: 31457280




0 - load model weights
Device 0: b'Tesla V100-SXM2-32GB', Memory : (95.27% free): 34359738368(total), 32735887360 (free), 1623851008 (used)
Max Memory occupied by tensors: 49632256
Max Memory Cached: 67108864
Current Memory occupied by tensors: 49632256
Current Memory cached occupied by tensors: 67108864




0 - generate grid of points at desired resolution
Device 0: b'Tesla V100-SXM2-32GB', Memory : (95.14% free): 34359738368(total), 32689750016 (free), 1669988352 (used)
Max Memory occupied by tensors: 110390784
Max Memory Cached: 113246208
Current Memory occupied by tensors: 49632256
Current Memory cached occupied by tensors: 113246208




0 - implicit surface prediction in batches and resuing computed features
Device 0: b'Tesla V100-SXM2-32GB', Memory : (95.14% free): 34359738368(total), 32689750016 (free), 1669988352 (used)
Max Memory occupied by tensors: 110390784
Max Memory Cached: 113246208
Current Memory occupied by tensors: 49632256
Current Memory cached occupied by tensors: 113246208




0 - after model prediction / generate meshes in parallel
Device 0: b'Tesla V100-SXM2-32GB', Memory : (95.13% free): 34359738368(total), 32685555712 (free), 1674182656 (used)
Max Memory occupied by tensors: 9599040512
Max Memory Cached: 10722738176
Current Memory occupied by tensors: 71394304
Current Memory cached occupied by tensors: 96468992




0 - timer statistics to disk
Device 0: b'Tesla V100-SXM2-32GB', Memory : (95.13% free): 34359738368(total), 32685555712 (free), 1674182656 (used)
Max Memory occupied by tensors: 9599040512
Max Memory Cached: 10722738176
Current Memory occupied by tensors: 71394304
Current Memory cached occupied by tensors: 96468992




[2023-06-28 15:07:47,184][__main__][INFO] - Timer summary:
[2023-06-28 15:07:47,184][__main__][INFO] - 	ReadData => 2.5469 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	ModelSetup => 0.1516 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	ModelLoadWeights => 0.0756 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	ImplicitSurfacePrediction => 28.6983 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	MeshExtraction => 33.7463 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	Total => 65.2330 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	PostProcessingImplicictSurface => 2.1764 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	lh_pial_ImplicictSurfaceSmooth => 0.1069 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	lh_pial_TopologyFix => 27.7479 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	lh_pial_IsoSurfaceExtraction => 0.1596 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	lh_white_ImplicictSurfaceSmooth => 0.0969 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	lh_white_TopologyFix => 23.2168 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	lh_white_IsoSurfaceExtraction => 0.1699 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	rh_pial_ImplicictSurfaceSmooth => 0.1176 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	rh_pial_TopologyFix => 27.7208 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	rh_pial_IsoSurfaceExtraction => 0.1526 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	rh_white_ImplicictSurfaceSmooth => 0.1049 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	rh_white_TopologyFix => 25.7180 secs
[2023-06-28 15:07:47,185][__main__][INFO] - 	rh_white_IsoSurfaceExtraction => 0.1779 secs
[2023-06-28 15:07:47,186][__main__][INFO] - Total Surface prediction finished in 65.2330 seconds
