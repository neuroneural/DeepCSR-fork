array is read
[2023-06-28 16:39:15,238][__main__][INFO] - Predicting surfaces with DeepCSR
Config:
user_config: null
inputs:
  mri_id: 200008
  mri_vol_path: /data/users2/washbee/speedrun/deepcsr-preprocessed/200008/mri.nii.gz
  model_checkpoint: /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir/best_model.pth
  model_surfaces:
  - lh_pial
  - lh_white
  - rh_pial
  - rh_white
generator:
  bbox_size:
  - 192.0
  - 228.0
  - 192.0
  resolution: 256
  points_batch_size: 1000000
  isrpr_vol_post_process: true
  isrpr_vol_smooth: 1.0
  fix_topology: true
  iso_surface_level: 0.0
model:
  hypercol: true
  device: cuda:0
outputs:
  output_dir: /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir-timing/checkpoints/bmtest-set/
  save_all: false

[2023-06-28 16:39:38,195][__main__][INFO] - MRI /data/users2/washbee/speedrun/deepcsr-preprocessed/200008/mri.nii.gz read with torch.Size([1, 182, 218, 182]) dimensions in 22.9560 secs

*********before loading model
 
Device 0: b'NVIDIA GeForce RTX 2080 Ti', Memory : (88.62% free): 11811160064(total), 10466557952 (free), 1344602112 (used)
Max Memory occupied by tensors: 29360640
Max Memory Cached: 31457280
Current Memory occupied by tensors: 29360640
Current Memory cached occupied by tensors: 31457280


*********after loading model
 
Device 0: b'NVIDIA GeForce RTX 2080 Ti', Memory : (88.31% free): 11811160064(total), 10430906368 (free), 1380253696 (used)
Max Memory occupied by tensors: 49632256
Max Memory Cached: 67108864
Current Memory occupied by tensors: 49632256
Current Memory cached occupied by tensors: 67108864

[2023-06-28 16:39:38,282][__main__][INFO] - 0.0849 secs for DeepCSR model setup:
DeepCSRNetwork(
  (encoder): HypercolumnNetwork(
    (max_pool): MaxPool3d(kernel_size=3, stride=2, padding=1, dilation=1, ceil_mode=False)
    (conv_in): Conv3d(1, 8, kernel_size=(3, 3, 3), stride=(1, 1, 1), padding=(1, 1, 1))
    (conv_0): Conv3d(8, 16, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
    (conv_1): Conv3d(16, 32, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
    (conv_2): Conv3d(32, 64, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
    (conv_3): Conv3d(64, 128, kernel_size=(3, 3, 3), stride=(2, 2, 2), padding=(1, 1, 1))
    (fc): Linear(in_features=4608, out_features=264, bias=True)
    (point_pool): PointPooling()
  )
  (decoder): OCCNetDecoder(
    (fc_p): Conv1d(3, 256, kernel_size=(1,), stride=(1,))
    (block0): CResnetBlockConv1d(
      (bn_0): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (bn_1): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (fc_0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (fc_1): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (actvn): ReLU()
    )
    (block1): CResnetBlockConv1d(
      (bn_0): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (bn_1): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (fc_0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (fc_1): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (actvn): ReLU()
    )
    (block2): CResnetBlockConv1d(
      (bn_0): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (bn_1): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (fc_0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (fc_1): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (actvn): ReLU()
    )
    (block3): CResnetBlockConv1d(
      (bn_0): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (bn_1): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (fc_0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (fc_1): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (actvn): ReLU()
    )
    (block4): CResnetBlockConv1d(
      (bn_0): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (bn_1): CBatchNorm1d(
        (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
        (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
      )
      (fc_0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (fc_1): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
      (actvn): ReLU()
    )
    (bn): CBatchNorm1d(
      (conv_gamma): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
      (conv_beta): Conv1d(512, 256, kernel_size=(1,), stride=(1,))
      (bn): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=True)
    )
    (fc_out): Conv1d(256, 4, kernel_size=(1,), stride=(1,))
  )
)
[2023-06-28 16:39:38,283][__main__][INFO] - Total number of parameters: 5060188
[2023-06-28 16:39:38,638][__main__][INFO] - Model weights at iteration 42000 and validation loss 2378.6959 loaded from /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir/best_model.pth in 0.3540 secs





model size: 19.325MB





[2023-06-28 16:39:38,640][__main__][INFO] - predicting implicit surfaces ...
[2023-06-28 16:39:38,926][__main__][INFO] - 16777216 query points generated to predict implicit surfaces
[2023-06-28 16:40:04,016][__main__][INFO] - predicted 9/17 batches of query points in 25.3757 secs
[2023-06-28 16:40:20,856][__main__][INFO] - Implicit surface prediction of shape (256, 256, 256, 4) computed in 42.1874 secs
[2023-06-28 16:40:20,858][__main__][INFO] - extracting meshes...
[2023-06-28 16:40:21,226][__main__][INFO] - Post-processing predicted implicit surface representation for surface lh_pial ...
[2023-06-28 16:40:21,471][__main__][INFO] - Post-processing predicted implicit surface representation for surface lh_white ...
[2023-06-28 16:40:21,769][__main__][INFO] - Post-processing predicted implicit surface representation for surface rh_pial ...
[2023-06-28 16:40:22,035][__main__][INFO] - Post-processing predicted implicit surface representation for surface rh_white ...
[2023-06-28 16:40:24,529][__main__][INFO] - Post-processed predicted implicit surface representation for surface lh_pial has (122, 221, 196) voxels and was computed in 3.3023 secs
[2023-06-28 16:40:24,533][__main__][INFO] - Smoothing predicted implicit surface representation for surface lh_pial with Gaussian kernel radius of 1.0...
[2023-06-28 16:40:24,776][__main__][INFO] - Post-processed predicted implicit surface representation for surface lh_white has (114, 217, 183) voxels and was computed in 3.3048 secs
[2023-06-28 16:40:24,777][__main__][INFO] - Smoothing predicted implicit surface representation for surface lh_white with Gaussian kernel radius of 1.0...
[2023-06-28 16:40:25,065][__main__][INFO] - Post-processed predicted implicit surface representation for surface rh_pial has (121, 221, 197) voxels and was computed in 3.2964 secs
[2023-06-28 16:40:25,067][__main__][INFO] - Smoothing predicted implicit surface representation for surface rh_pial with Gaussian kernel radius of 1.0...
[2023-06-28 16:40:25,073][__main__][INFO] - Post-processed predicted implicit surface representation for surface rh_white has (116, 217, 188) voxels and was computed in 3.0381 secs
[2023-06-28 16:40:25,075][__main__][INFO] - Smoothing predicted implicit surface representation for surface rh_white with Gaussian kernel radius of 1.0...
[2023-06-28 16:40:25,211][__main__][INFO] - Smoothed predicted implicit surface for lh_pial in 0.6779 secs
[2023-06-28 16:40:25,347][__main__][INFO] - Smoothed predicted implicit surface for lh_white in 0.5697 secs
[2023-06-28 16:40:25,587][__main__][INFO] - Smoothed predicted implicit surface for rh_white in 0.5117 secs
[2023-06-28 16:40:25,618][__main__][INFO] - Smoothed predicted implicit surface for rh_pial in 0.5507 secs
[2023-06-28 16:41:09,242][__main__][INFO] - fixing topology of surface with nighres toolbox...
[2023-06-28 16:41:09,242][__main__][INFO] - fixing topology of surface with nighres toolbox...
[2023-06-28 16:41:09,242][__main__][INFO] - fixing topology of surface with nighres toolbox...
[2023-06-28 16:41:09,242][__main__][INFO] - fixing topology of surface with nighres toolbox...

Topology Correction
Topology Correction
Topology Correction
Topology Correction



Opening LUT: java.io.FileInputStream@533ddba
Opening LUT: java.io.FileInputStream@533ddba
Opening LUT: java.io.FileInputStream@533ddba
Opening LUT: java.io.FileInputStream@533ddba
Simple points: 2537750
Simple points: 2537750
Simple points: 2537750
Simple points: 2537750
intialize from min levelset
intialize from min levelset
intialize from bounding box
intialize from bounding box
initialization
initialization
fast marching correction (levelsets)
fast marching correction (levelsets)
initialization
fast marching correction (levelsets)
initialization
init
init
fast marching correction (levelsets)
init
init
done
[2023-06-28 16:41:49,164][__main__][INFO] - Fixed topology of surface lh_white using nighres in 39.9213 secs
[2023-06-28 16:41:49,165][__main__][INFO] - extracting 0.0 iso-surface of surface lh_white...
done
[2023-06-28 16:41:49,759][__main__][INFO] - Surface lh_white extracted in 0.3320 secs and saved to /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir-timing/checkpoints/bmtest-set/200008_lh_white.stl
[2023-06-28 16:41:50,622][__main__][INFO] - Fixed topology of surface rh_white using nighres in 41.3796 secs
[2023-06-28 16:41:50,623][__main__][INFO] - extracting 0.0 iso-surface of surface rh_white...
[2023-06-28 16:41:51,068][__main__][INFO] - Surface rh_white extracted in 0.2465 secs and saved to /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir-timing/checkpoints/bmtest-set/200008_rh_white.stl
done
done
[2023-06-28 16:41:53,979][__main__][INFO] - Fixed topology of surface rh_pial using nighres in 44.7369 secs
[2023-06-28 16:41:53,980][__main__][INFO] - extracting 0.0 iso-surface of surface rh_pial...
[2023-06-28 16:41:54,183][__main__][INFO] - Fixed topology of surface lh_pial using nighres in 44.9404 secs
[2023-06-28 16:41:54,184][__main__][INFO] - extracting 0.0 iso-surface of surface lh_pial...
[2023-06-28 16:41:54,321][__main__][INFO] - Surface rh_pial extracted in 0.2066 secs and saved to /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir-timing/checkpoints/bmtest-set/200008_rh_pial.stl
[2023-06-28 16:41:54,525][__main__][INFO] - Surface lh_pial extracted in 0.2086 secs and saved to /data/users2/washbee/speedrun/outputdirs/deepcsr-output_dir-timing/checkpoints/bmtest-set/200008_lh_pial.stl
[2023-06-28 16:41:54,969][__main__][INFO] - Surfaces extracted in 94.1108 secs
0 - override config
Device 0: b'NVIDIA GeForce RTX 2080 Ti', Memory : (97.82% free): 11811160064(total), 11553800192 (free), 257359872 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - read MRI
Device 0: b'NVIDIA GeForce RTX 2080 Ti', Memory : (97.80% free): 11811160064(total), 11550785536 (free), 260374528 (used)
Max Memory occupied by tensors: 0
Max Memory Cached: 0
Current Memory occupied by tensors: 0
Current Memory cached occupied by tensors: 0




0 - setup model
Device 0: b'NVIDIA GeForce RTX 2080 Ti', Memory : (88.62% free): 11811160064(total), 10466557952 (free), 1344602112 (used)
Max Memory occupied by tensors: 29360640
Max Memory Cached: 31457280
Current Memory occupied by tensors: 29360640
Current Memory cached occupied by tensors: 31457280




0 - load model weights
Device 0: b'NVIDIA GeForce RTX 2080 Ti', Memory : (88.31% free): 11811160064(total), 10430906368 (free), 1380253696 (used)
Max Memory occupied by tensors: 49632256
Max Memory Cached: 67108864
Current Memory occupied by tensors: 49632256
Current Memory cached occupied by tensors: 67108864




0 - generate grid of points at desired resolution
Device 0: b'NVIDIA GeForce RTX 2080 Ti', Memory : (87.92% free): 11811160064(total), 10384769024 (free), 1426391040 (used)
Max Memory occupied by tensors: 110390784
Max Memory Cached: 113246208
Current Memory occupied by tensors: 49632256
Current Memory cached occupied by tensors: 113246208




0 - implicit surface prediction in batches and resuing computed features
Device 0: b'NVIDIA GeForce RTX 2080 Ti', Memory : (87.92% free): 11811160064(total), 10384769024 (free), 1426391040 (used)
Max Memory occupied by tensors: 110390784
Max Memory Cached: 113246208
Current Memory occupied by tensors: 49632256
Current Memory cached occupied by tensors: 113246208




0 - after model prediction / generate meshes in parallel
Device 0: b'NVIDIA GeForce RTX 2080 Ti', Memory : (86.77% free): 11811160064(total), 10248454144 (free), 1562705920 (used)
Max Memory occupied by tensors: 9599518720
Max Memory Cached: 9720299520
Current Memory occupied by tensors: 71394304
Current Memory cached occupied by tensors: 228589568




0 - timer statistics to disk
Device 0: b'NVIDIA GeForce RTX 2080 Ti', Memory : (86.77% free): 11811160064(total), 10248454144 (free), 1562705920 (used)
Max Memory occupied by tensors: 9599518720
Max Memory Cached: 9720299520
Current Memory occupied by tensors: 71394304
Current Memory cached occupied by tensors: 228589568




[2023-06-28 16:41:54,970][__main__][INFO] - Timer summary:
[2023-06-28 16:41:54,971][__main__][INFO] - 	ReadData => 22.9560 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	ModelSetup => 0.0849 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	ModelLoadWeights => 0.3540 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	ImplicitSurfacePrediction => 42.1874 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	MeshExtraction => 94.1108 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	Total => 159.7320 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	PostProcessingImplicictSurface => 3.0381 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	lh_pial_ImplicictSurfaceSmooth => 0.6779 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	lh_pial_TopologyFix => 44.9404 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	lh_pial_IsoSurfaceExtraction => 0.2086 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	lh_white_ImplicictSurfaceSmooth => 0.5697 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	lh_white_TopologyFix => 39.9213 secs
[2023-06-28 16:41:54,971][__main__][INFO] - 	lh_white_IsoSurfaceExtraction => 0.3320 secs
[2023-06-28 16:41:54,972][__main__][INFO] - 	rh_pial_ImplicictSurfaceSmooth => 0.5507 secs
[2023-06-28 16:41:54,972][__main__][INFO] - 	rh_pial_TopologyFix => 44.7369 secs
[2023-06-28 16:41:54,972][__main__][INFO] - 	rh_pial_IsoSurfaceExtraction => 0.2066 secs
[2023-06-28 16:41:54,972][__main__][INFO] - 	rh_white_ImplicictSurfaceSmooth => 0.5117 secs
[2023-06-28 16:41:54,972][__main__][INFO] - 	rh_white_TopologyFix => 41.3796 secs
[2023-06-28 16:41:54,972][__main__][INFO] - 	rh_white_IsoSurfaceExtraction => 0.2465 secs
[2023-06-28 16:41:54,973][__main__][INFO] - Total Surface prediction finished in 159.7320 seconds
